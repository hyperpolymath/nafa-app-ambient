cat > cookbook.adoc << 'EOF'
= NAFA Developer Cookbook
:toc:
:icons: font

This document explains how to use the `justfile` to build, test, and run the NAFA project. All contributors should use `just` for these tasks to ensure consistency.

First, xref:setup[install `just`].

== Overview==

The `justfile` is the central control plane for this project. It is written to use the **Oil shell**.

Common aliases:
* `just s`: Alias for `setup`.
* `just r`: Alias for `run`.
* `just c`: Alias for `check`.
* `just t`: Alias for `test`.
* `just b`: Alias for `build`.

== ðŸ› ï¸ Setup & Bootstrap

[cols="1,3"]
|===
| Recipe | Description

| `just setup`
| *(Default)* This is the main bootstrap command. It runs all other setup tasks in order: installs `asdf` plugins, installs global tools via `npm`/`cargo`, installs all project dependencies, and generates the initial config.

| `just setup:asdf`
| Reads the `.tool-versions` file and installs all required language runtimes (Elixir, Node.js, Rust, Elm, Kotlin) using `asdf`.

| `just setup:tools`
| Installs the globally required CLI tools that are not part of project dependencies: `rescript`, `tauri-cli`, and `nickel-lang-cli`.

| `just setup:deps`
| Meta-recipe to install dependencies for all micro-services (`backend`, `ui`, `logic`, `mobile`).

| `just deps:backend`
| Runs `mix deps.get` for the Elixir backend. *Crucially, it also edits `config/config.exs` to ensure the **Bandit** webserver is used instead of Cowboy.*

| `just deps:ui`
| Runs `elm-tooling install` for the Elm UI.

| `just deps:logic`
| Runs `npm install` for the ReScript logic.

| `just deps:mobile`
| Runs `gradlew dependencies` for the Kotlin modules.
|===

== âš™ï¸ Configuration

[cols="1,3"]
|===
| Recipe | Description

| `just config`
| Generates static JSON configuration files from the Nickel definitions in `nickel-rituals/`. It creates `config/development.json` and `config/production.json`.
|===

== ðŸ Run & Develop

[cols="1,3"]
|===
| Recipe | Description

| `just run`
| Runs the main Elixir (Phoenix) backend server. Since Phoenix is configured to serve the compiled static assets (from Elm and ReScript), this is the main entry point for development.

| `just run:tauri`
| Runs the Tauri desktop splash screen in development mode.

| `just run:ui`
| Runs `elm-live` to provide hot-reloading for the Elm UI.

| `just run:logic`
| Runs the ReScript compiler in watch mode (`-w`).
|===

== âœ… Check, Lint, Format

[cols="1,3"]
|===
| Recipe | Description

| `just check`
| This is the main quality gate. It runs `format`, `lint`, and `typecheck` in sequence. This is run in CI and in the `pre-commit` hook.

| `just format`
| Runs formatters for all languages: `mix format` (Elixir), `elm-format` (Elm), `npx rescript format` (ReScript), and `cargo fmt` (Rust).

| `just lint`
| Runs linters: `mix credo` (Elixir) and `mix dialyzer` (Elixir type-checking).

| `just typecheck`
| Runs static analysis and type-checkers that are not part of the main lint pass (e.g., `elm make --output=/dev/null`).
|===

== ðŸ§ª Test

[cols="1,3"]
|===
| Recipe | Description

| `just test`
| Meta-recipe that runs all test suites for all services.

| `just test:backend`
| Runs `mix test` for the Elixir backend.

| `just test:logic`
| Runs `npm test` for the ReScript logic.

| `just test:ui`
| Runs `elm-test` for the Elm UI.

| `just test:mobile`
| Runs `./gradlew check` for the Kotlin modules.
|===

== ðŸ“¦ Build & Package

[cols="1,3"]
|===
| Recipe | Description

| `just build`
| Creates a full production-ready build. It cleans old artifacts, builds the ReScript and Elm assets, tells Phoenix to digest them, and builds the native Tauri app.

| `just package:podman:build`
| Builds the final production OCI container using `podman` and the `Containerfile`.

| `just package:podman:push`
| Builds the container and then pushes it to the GitLab container registry.
|===

== ðŸ§¹ Cleanup

[cols="1,3"]
|===
| Recipe | Description

| `just clean`
| Removes all build artifacts, caches, and `node_modules` folders from all sub-projects.

| `just clean:all`
| Runs `just clean` and then executes the `robot-repo-cleaner` Salt state to perform a deep-system scrub (e.g., pruning Podman images and `asdf` caches).
|===
EOF